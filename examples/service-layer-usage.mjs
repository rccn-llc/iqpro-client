/**\n * Example: IQ Pro+ Client Service Layer Usage\n * \n * This example demonstrates how to use the comprehensive service layer\n * built on OAuth 2.0 authentication for managing customers, payments,\n * and subscriptions.\n */\n\nimport { IQProClient } from '../src/IQProClient';\nimport type { Customer } from '../src/types/Customer';\nimport type { Payment } from '../src/types/Payment';\nimport type { Subscription } from '../src/types/Subscription';\n\nasync function serviceLayerExample() {\n  // Initialize the client with environment variables\n  const client = new IQProClient({\n    clientId: process.env.IQPRO_CLIENT_ID!,\n    clientSecret: process.env.IQPRO_CLIENT_SECRET!,\n    baseUrl: 'https://api-sandbox.iqpro.com', // Use sandbox for testing\n    debug: true // Enable debug logging\n  });\n\n  try {\n    // Set gateway context (required for most operations)\n    client.setGatewayContext('your-gateway-id', true); // true = test mode\n\n    // üîê Test authentication\n    console.log('Testing OAuth authentication...');\n    const isAuthenticated = await client.testAuthentication();\n    console.log('‚úÖ Authentication successful:', isAuthenticated);\n\n    // üë§ Customer Management\n    console.log('\\n--- Customer Management ---');\n    \n    // Create a new customer\n    const newCustomer = await client.customers.create({\n      firstName: 'John',\n      lastName: 'Doe',\n      email: 'john.doe@example.com',\n      phone: '+1-555-123-4567',\n      company: 'Acme Corp',\n      address: {\n        line1: '123 Main Street',\n        city: 'Anytown',\n        state: 'CA',\n        postalCode: '12345',\n        country: 'US'\n      },\n      tags: ['premium', 'enterprise']\n    });\n    console.log('‚úÖ Customer created:', newCustomer.id);\n\n    // Get customer by ID\n    const customer = await client.customers.get(newCustomer.id);\n    console.log('‚úÖ Customer retrieved:', customer.email);\n\n    // List customers with filters\n    const customerList = await client.customers.list({\n      page: 1,\n      limit: 10,\n      status: 'active',\n      sortBy: 'createdAt',\n      sortOrder: 'desc'\n    });\n    console.log(`‚úÖ Found ${customerList.pagination.total} customers`);\n\n    // Get customer statistics\n    const stats = await client.customers.getStats();\n    console.log('üìä Customer stats:', {\n      total: stats.total,\n      active: stats.active,\n      averageLTV: stats.averageLifetimeValue\n    });\n\n    // üí≥ Payment Management\n    console.log('\\n--- Payment Management ---');\n    \n    // Create a payment method first (in real usage, this would come from your frontend)\n    const paymentMethod = await client.payments.createPaymentMethod({\n      customerId: newCustomer.id,\n      type: 'credit_card', // This would normally come from a tokenized card\n      token: 'pm_test_token_visa', // Test token\n      billingAddress: {\n        line1: '123 Main Street',\n        city: 'Anytown',\n        state: 'CA',\n        postalCode: '12345',\n        country: 'US'\n      },\n      setAsDefault: true\n    });\n    console.log('‚úÖ Payment method created:', paymentMethod.id);\n\n    // Create a payment\n    const payment = await client.payments.create({\n      amount: 2500, // $25.00 in cents\n      currency: 'USD',\n      customerId: newCustomer.id,\n      paymentMethodId: paymentMethod.id,\n      description: 'Service subscription payment',\n      metadata: {\n        orderId: 'order_123',\n        invoiceId: 'inv_456'\n      }\n    });\n    console.log('‚úÖ Payment created:', payment.id, `($${payment.amount / 100})`);\n\n    // List payments for customer\n    const paymentList = await client.payments.list({\n      customerId: newCustomer.id,\n      status: 'completed',\n      limit: 5\n    });\n    console.log(`‚úÖ Found ${paymentList.pagination.total} payments for customer`);\n\n    // üìã Subscription Management\n    console.log('\\n--- Subscription Management ---');\n    \n    // Create a price plan first\n    const pricePlan = await client.subscriptions.createPlan({\n      name: 'Professional Plan',\n      description: 'Full-featured professional subscription',\n      amount: 2999, // $29.99/month\n      currency: 'USD',\n      interval: 'month',\n      intervalCount: 1,\n      trialDays: 14\n    });\n    console.log('‚úÖ Price plan created:', pricePlan.name);\n\n    // Create a subscription\n    const subscription = await client.subscriptions.create({\n      customerId: newCustomer.id,\n      planId: pricePlan.id,\n      paymentMethodId: paymentMethod.id,\n      trialDays: 14,\n      metadata: {\n        source: 'website',\n        campaign: 'spring2024'\n      }\n    });\n    console.log('‚úÖ Subscription created:', subscription.id, `(${subscription.status})`);\n\n    // List active subscriptions\n    const subscriptionList = await client.subscriptions.list({\n      status: 'active',\n      limit: 10\n    });\n    console.log(`‚úÖ Found ${subscriptionList.pagination.total} active subscriptions`);\n\n    // Get subscription metrics\n    const metrics = await client.subscriptions.getMetrics();\n    console.log('üìä Subscription metrics:', {\n      activeCount: metrics.activeCount,\n      mrr: `$${metrics.monthlyRecurringRevenue / 100}`,\n      arr: `$${metrics.annualRecurringRevenue / 100}`\n    });\n\n    // üîÑ Advanced Operations\n    console.log('\\n--- Advanced Operations ---');\n\n    // Add customer tags\n    const updatedCustomer = await client.customers.addTags(newCustomer.id, ['high-value']);\n    console.log('‚úÖ Customer tags updated:', updatedCustomer.tags);\n\n    // Pause subscription\n    const pausedSubscription = await client.subscriptions.pause(\n      subscription.id,\n      undefined, // No resume date (manual resume)\n      'keep_as_draft' // Keep invoices as drafts\n    );\n    console.log('‚úÖ Subscription paused:', pausedSubscription.status);\n\n    // Resume subscription\n    const resumedSubscription = await client.subscriptions.resume(subscription.id);\n    console.log('‚úÖ Subscription resumed:', resumedSubscription.status);\n\n    // Get rate limit status\n    const rateLimitStatus = client.getRateLimitStatus();\n    console.log('üìà Rate limit status:', {\n      remaining: rateLimitStatus.requestsRemaining,\n      resetTime: new Date(rateLimitStatus.windowResetTime).toLocaleTimeString()\n    });\n\n    // üîç Custom API Calls\n    console.log('\\n--- Custom API Calls ---');\n    \n    // Use direct HTTP methods for custom endpoints\n    const customData = await client.get('/custom/analytics', {\n      query: {\n        period: '30d',\n        metrics: 'revenue,customers'\n      }\n    });\n    console.log('‚úÖ Custom API call successful');\n\n    console.log('\\nüéâ Service layer example completed successfully!');\n    \n  } catch (error) {\n    console.error('‚ùå Error during service layer example:', error);\n    \n    if (error instanceof Error) {\n      console.error('Error details:', {\n        name: error.name,\n        message: error.message,\n        stack: error.stack?.split('\\n').slice(0, 3).join('\\n')\n      });\n    }\n  }\n}\n\n// Export the example function\nexport { serviceLayerExample };\n\n// Run example if called directly\nif (require.main === module) {\n  serviceLayerExample().catch(console.error);\n}"